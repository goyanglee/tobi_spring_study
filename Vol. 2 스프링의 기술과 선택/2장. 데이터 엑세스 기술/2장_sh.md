# 2장 데이터 액세스 기술

<br/>

### 스프링은 주요 자바 데이터 액세스 기술을 모두 지원한다. 

> 자바는 JDBC API 외에도 JDBC 사용을 추상화해주는 iBatis SQLMapper나 오픈소스 ORM 대표 하이버네이트, JPA, JDO 등 다양한 데이터 액세스 기술을 제공한다. 

<br/>

#### 데이터 액세스 계층은 DAO 패턴으로 분리하기: DTO 또는 도메인 오브젝트만을 사용하는 인터페이스를 통해 데이터 액세스 기술을 외부에 노출하지 않는다.

- 인터페이스를 이용한 접근필요
  - DAO는 인터페이스를 이용해서 접근하고 DI되도록 생성해야 한다. 
    - DAO 클래스의 메소드를 생각없이 public으로 선언하지 않도록 주의
    - persist() 처럼 특정 데이터 액세스 기술에서 사용하는 메소드 이름을 사용하지 말자. 
- 예외처리 주의
  - DAO 밖으로 던지는 예외는 런타임예외여야 한다. (데이터 액세스 중에 발생하는 예외는 대부분 복구가 불가능하기 때문)
  - DAO 메소드 선언부에 throws SQLException 처럼 내부 기술을 드러내는 예외를 직접노출 X
  - throws Exception 같은 무책임한 선언도 X

<br/>

#### 스프링은 데이터 액세스 기술을 위한 템플릿을 제공한다: 템플릿/콜백 패턴 - 미리 만들어진 작업흐름을 담는다. 

- 중복코드 제거
- 트랜잭션 동기화기능 제공

<br/>

#### 다중사용자를 갖는 엔터프라이즈 시스템에서는 반드시 DB 연결 풀 기능을 지원하는 DataSource를 사용하기

> #### 스프링에서는 DataSource를 하나의 독립된 빈으로 등록하도록 강력하게 권장한다
>
> 스프링 데이터 기술의 다양한 서비스에서 DataSource를 필요로 하므로 공유가능한 스프링 빈으로 등록해줘야 한다. 스프링은 주요 데이터 액세스 기술이 자체적인 DataSource 생성방식 대신 스프링 빈으로 등록된 DataSource를 사용하는 데 필요한 방법을 제공해준다. 

<b>테스트를 위한 것</b> : 

- SimpleDriverDataSource : 매번 DB 커넥션 새로 만들고 풀 관리X
- SingleConnectionDataSource : 하나의 물리적인 DB 커넥션 만들어두고 사용. 순차적 통합테스트에 적합. 동시에 N개 스레드가 동작하면 사용X

<b>오픈소스 또는 상용 디비 커넥션 풀</b> :

- 아파치 Commons DBCP : 가장 보편적인 DB 커넥션 풀 라이브러리
- c3p0 JDBC/DataSource Resource Pool
- 상용 DB 커넥션 풀

<b>JDNI/WAS DB 풀</b> : 대부분의 자바 서버는 자체적으로 DB 풀 서비스 제공해준다. 

<br/>

