# 3장. 템플릿

[https://www.notion.so/3-fb0c4d919b2c4fd48f815424858ed85a](https://www.notion.so/3-fb0c4d919b2c4fd48f815424858ed85a)

복습

1방에서는 dao코드에 di를 적용해나가는 과정을 통해서 관심이 다른 코드를 다양한 방법으로 분리하고,

확장과 변경에 용이하게 대응할 수 있는 설계구조로 개선하는 작업을 했다.

개방 폐쇄 원칙(OCP) : 확장에는 자유롭게 열려 있고 변경에는 굳게 닫혀 있다는 객체지향 설계의 핵심 원칙

⇒ 코드에서 어떤 부분은 변경을 통해 그 기능이 다양해지고 확장하려는 성질이 있고, 어떤 부분은 고정되어 있고 변하지 않으려는 성질이 있음을 말해준다.

### 템플릿이란

이렇게 바뀌는 성질이 다른 코드 중에서 변경이 거의 일어나지 않으며 일정한 패턴으로 유지되는 특성을 가진 부분을 자유롭게 변경되는 성질을 가진 부분으로부터 독립시켜 효과적으로 활용할 수 있도록 하는 방법.

# 3.1 다시 보는 초난감 DAO

## 3.1.1 예외처리 기능을 갖춘 DAO

예외 처리 : 중간에 어떤 이유로든 예외가 발생했을 경우에도 사용한 리소스를 반드시 반환하도록 만들어야 한다.

### JDBC 수정 기능의 예외 처리 코드

일반적으로 서버에서는 제한된 개수의 DB 커넥션을 만들어서 재사용 가능한 풀로 관리한다.

DB 풀은 매번 getConnection()으로 가져간 커넥션을 명시적으로 close()해서 돌려줘야하지만 다시 풀에 넣었다가 다음 커넥션 요청이 있을 때 재사용할 수 있다.

그런데, 오류가 날 때마다 미처 반환되지 못한 connection이 계속 쌓이면 어느 순간에 커넥션 풀에 여유가 없어지고 리소스가 모자란다는 심각한 오류를 내며 서버가 중단될 수 있다.

* **리소스 반환과 close()

close()**의 의미는 **리소스 반환**
미리 정해진 풀 안에 제한된 수의 리소스(Connection,Statement)를 만들어두고 필요할 때 이를 할당하고, 반환하면 다시 풀에 넣는 방식으로 운영된다. 

요청이 매우 많은 서버 환경에서는 매번 새로운 리소스를 생성하는 대신 풀에 미리 만들어둔 리소스를 돌려가며 사용하는 편이 훨씬 유리하다. 대신, 사용한 리소스는 빠르게 반환해야 한다. 그렇지 않으면 풀에 있는 리소스가  고갈되고 결국 문제가 발생한다. 즉, close()는 사용한 리소스를 풀로 다시 돌려주는 역할 

JDBC 코드에서는 try/catch/finally 구문 사용을 권장 

```java
try{
} catch(SQLException e){
  throw e;
} finally{ //finally 이므로 try 블록에서 예외가 발생했을 때나 안 했을 때나 모두 실행 된다.

    //null 인지 확인 후 close, -> null 인데 close 하면 오히려 에러날 수 있음.
    //그래서 이부분도 try/catch로 한번 더 감싸줘서 로그를 찍어두면 좋음.  
}
```

### JDBC 조회 기능의 예외처리

close()는 만들어진 순서의 반대로 하는 것이 원칙이다.

# 3.2 변하는 것과 변하지 않는 것

## 3.2.1 JDBC try/catch/finally 코드의 문제점